before_script:
  - dpkg --add-architecture i386
  - apt-get update -qq && apt-get install -y -qq ftjam gdb gcc g++ wget bsdtar clang libstdc++6:i386 libgcc1:i386 zlib1g:i386 libncurses5:i386 > /dev/null 2>&1
  - mkdir -v toolchains
  - sh -c "cd toolchains && wget -q http://releases.linaro.org/archive/15.06/components/toolchain/binaries/4.8/arm-linux-gnueabi/gcc-linaro-4.8-2015.06-x86_64_arm-linux-gnueabi.tar.xz && tar -xJf gcc-linaro-4.8-2015.06-x86_64_arm-linux-gnueabi.tar.xz"
  - sh -c "cd toolchains && wget -q https://sourcery.mentor.com/GNUToolchain/package12225/public/arm-none-linux-gnueabi/arm-2013.11-33-arm-none-linux-gnueabi-i686-pc-linux-gnu.tar.bz2 && tar -xjf arm-2013.11-33-arm-none-linux-gnueabi-i686-pc-linux-gnu.tar.bz2 && mv -v arm-2013.11/ codesourcery-gcc/"
  - sh -c "cd toolchains && wget -q http://releases.linaro.org/components/toolchain/binaries/latest-5/aarch64_be-linux-gnu/gcc-linaro-5.5.0-2017.10-x86_64_aarch64_be-linux-gnu.tar.xz && tar -xJf gcc-linaro-5.5.0-2017.10-x86_64_aarch64_be-linux-gnu.tar.xz"

dummyplatform_and_tests:
  script:
    - mkdir dummyplatform-gcc-builddir
    - sh -c "cd dummyplatform-gcc-builddir && CC=/usr/bin/gcc CXX=/usr/bin/g++ LD=/usr/bin/g++ ../configure -platform=dummy -modules=all && make"
    - /usr/bin/g++ -g -Os tests/test01-muleapplication-test.cpp dummyplatform-gcc-builddir/libMule.a -Isrc -Idummyplatform-gcc-builddir/src -o tests/run-test01
    - ./tests/run-test01
    - /usr/bin/g++ -g -Os tests/test02-mulefile-currentdirectory.cpp dummyplatform-gcc-builddir/libMule.a -Isrc -Idummyplatform-gcc-builddir/src -o tests/run-test02
    - touch ./popcorn.txt
    - sh -c "echo \"Testing 1 2 3\" > popcorn.txt"
    - cat ./popcorn.txt
    - ./tests/run-test02
    - sh -c "if test -e \"./popcorn.txt\"; then rm -r -f popcorn.txt; fi"
    - ./tests/run-test02
    - /usr/bin/g++ -g -Os tests/test03-mulesound-beeping.cpp dummyplatform-gcc-builddir/libMule.a -Isrc -Idummyplatform-gcc-builddir/src -o tests/run-test03
    - rm -r -f ./tests/run-test0* ./dummyplatform-gcc-builddir/

legoev3platform_and_tests_linaroalternativetoolchain:
  script:
    - ftjam -sDEBUG=yes -sMULETARGET=legoev3 -sMULECOMPILERFLAGS="-march=armv5 -mtune=arm9 -static-libstdc++ -static-libgcc" -sCC=$PWD/toolchains/gcc-linaro-4.8-2015.06-x86_64_arm-linux-gnueabi/bin/arm-linux-gnueabi-gcc -sCXX=$PWD/toolchains/gcc-linaro-4.8-2015.06-x86_64_arm-linux-gnueabi/bin/arm-linux-gnueabi-g++ -sLINK=$PWD/toolchains/gcc-linaro-4.8-2015.06-x86_64_arm-linux-gnueabi/bin/arm-linux-gnueabi-g++ -sLINKFLAGS="-march=armv5 -mtune=arm9 -static-libstdc++ -static-libgcc" -q all
    - $PWD/toolchains/gcc-linaro-4.8-2015.06-x86_64_arm-linux-gnueabi/bin/arm-linux-gnueabi-g++ -g -Os tests/test01-muleapplication-test.cpp libMule.a -Isrc -o tests/run-test01 -static-libstdc++ -static-libgcc -Isrc/3rdparty/EV3-API-master/API
    - $PWD/toolchains/gcc-linaro-4.8-2015.06-x86_64_arm-linux-gnueabi/bin/arm-linux-gnueabi-g++ -g -Os tests/test02-mulefile-currentdirectory.cpp libMule.a -Isrc -o tests/run-test02 -static-libstdc++ -static-libgcc -Isrc/3rdparty/EV3-API-master/API
    - $PWD/toolchains/gcc-linaro-4.8-2015.06-x86_64_arm-linux-gnueabi/bin/arm-linux-gnueabi-g++ -g -Os tests/test03-mulesound-beeping.cpp libMule.a -Isrc -o tests/run-test03 -static-libstdc++ -static-libgcc -Isrc/3rdparty/EV3-API-master/API
    - ftjam -sDEBUG=yes -sMULETARGET=legoev3 -sMULECOMPILERFLAGS="-march=armv5 -mtune=arm9 -static-libstdc++ -static-libgcc" -sCC=$PWD/toolchains/gcc-linaro-4.8-2015.06-x86_64_arm-linux-gnueabi/bin/arm-linux-gnueabi-gcc -sCXX=$PWD/toolchains/gcc-linaro-4.8-2015.06-x86_64_arm-linux-gnueabi/bin/arm-linux-gnueabi-g++ -sLINK=$PWD/toolchains/gcc-linaro-4.8-2015.06-x86_64_arm-linux-gnueabi/bin/arm-linux-gnueabi-g++ -sLINKFLAGS="-march=armv5 -mtune=arm9 -static-libstdc++ -static-libgcc" -q clean
    - rm -r -f -v tests/run-test0* src/core/muleconfig.*

dummyplatform_and_tests_llvmalternativetoolchain:
  script:
    - mkdir dummyplatform-clang-builddir
    - sh -c "cd dummyplatform-clang-builddir && CC=/usr/bin/clang CXX=/usr/bin/clang++ LD=/usr/bin/clang++ ../configure -platform=dummy -modules=all && make"
    - /usr/bin/clang++ -g -Os tests/test01-muleapplication-test.cpp libMule.a -Isrc -o tests/run-test01
    - ./tests/run-test01
    - /usr/bin/clang++ -g -Os tests/test02-mulefile-currentdirectory.cpp libMule.a -Isrc -o tests/run-test02
    - ./tests/run-test02
    - /usr/bin/clang++ -g -Os tests/test03-mulesound-beeping.cpp libMule.a -Isrc -o tests/run-test03
    - sh -c "cd dummyplatform-clang-builddir && make clean"
    - rm -r -f ./dummyplatform-clang-builddir ./tests/run-test0*

legoev3platform_and_tests:
  script:
    - ftjam -sDEBUG=yes -sMULETARGET=legoev3 -sMULECOMPILERFLAGS="-march=armv4t  -static-libstdc++ -static-libgcc" -sCC=$PWD/toolchains/codesourcery-gcc/bin/arm-none-linux-gnueabi-gcc -sCXX=$PWD/toolchains/codesourcery-gcc/bin/arm-none-linux-gnueabi-c++ -sLINK=$PWD/toolchains/codesourcery-gcc/bin/arm-none-linux-gnueabi-c++ -sLINKFLAGS="-march=armv4t  -static-libstdc++ -static-libgcc" -q all
    - $PWD/toolchains/codesourcery-gcc/bin/arm-none-linux-gnueabi-c++ -g -Os tests/test01-muleapplication-test.cpp libMule.a -Isrc -o tests/run-test01 -static-libstdc++ -static-libgcc -Isrc/3rdparty/EV3-API-master/API
    - $PWD/toolchains/codesourcery-gcc/bin/arm-none-linux-gnueabi-c++ -g -Os tests/test02-mulefile-currentdirectory.cpp libMule.a -Isrc -o tests/run-test02 -static-libstdc++ -static-libgcc -Isrc/3rdparty/EV3-API-master/API
    - $PWD/toolchains/codesourcery-gcc/bin/arm-none-linux-gnueabi-c++ -g -Os tests/test03-mulesound-beeping.cpp libMule.a -Isrc -o tests/run-test03 -static-libstdc++ -static-libgcc -Isrc/3rdparty/EV3-API-master/API
    - ftjam -sDEBUG=yes -sMULETARGET=legoev3 -sMULECOMPILERFLAGS="-march=armv4t  -static-libstdc++ -static-libgcc" -sCC=$PWD/toolchains/gcc-linaro-4.8-2015.06-x86_64_arm-linux-gnueabi/bin/arm-linux-gnueabi-gcc -sCXX=$PWD/toolchains/codesourcery-gcc/bin/arm-none-linux-gnueabi-c++ -sLINK=$PWD/toolchains/codesourcery-gcc/bin/arm-none-linux-gnueabi-c++ -sLINKFLAGS="-march=armv4t  -static-libstdc++ -static-libgcc" -q clean
    - rm -r -f -v tests/run-test0* src/core/muleconfig.*

raspberrypiplatform_and_tests:
  script:
    - ftjam -sDEBUG=yes -sMULETARGET=pigpio_rpi -sMULECOMPILERFLAGS="-pthread -march=armv8-a -mtune=cortex-a53 -static-libstdc++ -static-libgcc" -sLINKFLAGS="-march=armv8-a -mtune=cortex-a53 -static-libstdc++ -static-libgcc -pthread" -sCC=$PWD/toolchains/gcc-linaro-5.5.0-2017.10-x86_64_aarch64_be-linux-gnu/bin/aarch64_be-linux-gnu-gcc -sCXX=$PWD/toolchains/gcc-linaro-5.5.0-2017.10-x86_64_aarch64_be-linux-gnu/bin/aarch64_be-linux-gnu-g++ -sLINK=$PWD/toolchains/gcc-linaro-5.5.0-2017.10-x86_64_aarch64_be-linux-gnu/bin/aarch64_be-linux-gnu-g++ -q all
    - $PWD/toolchains/gcc-linaro-5.5.0-2017.10-x86_64_aarch64_be-linux-gnu/bin/aarch64_be-linux-gnu-g++ -pthread -Isrc/3rdparty/pigpio-master -std=gnu++11 -g -Os -static-libstdc++ -static-libgcc -march=armv8-a -mtune=cortex-a53 tests/test01-muleapplication-test.cpp libMule.a -Isrc -o tests/run-test01
    - $PWD/toolchains/gcc-linaro-5.5.0-2017.10-x86_64_aarch64_be-linux-gnu/bin/aarch64_be-linux-gnu-g++ -pthread -Isrc/3rdparty/pigpio-master -std=gnu++11 -g -Os -static-libstdc++ -static-libgcc -march=armv8-a -mtune=cortex-a53 tests/test02-mulefile-currentdirectory.cpp libMule.a -Isrc -o tests/run-test02
    - $PWD/toolchains/gcc-linaro-5.5.0-2017.10-x86_64_aarch64_be-linux-gnu/bin/aarch64_be-linux-gnu-g++ -pthread -Isrc/3rdparty/pigpio-master -std=gnu++11 -g -Os -static-libstdc++ -static-libgcc -march=armv8-a -mtune=cortex-a53 tests/test03-mulesound-beeping.cpp libMule.a -Isrc -o tests/run-test03
    - ftjam -sDEBUG=yes -sMULETARGET=rpi -sMULECOMPILERFLAGS="-pthread -march=armv8-a -mtune=cortex-a53 -static-libstdc++ -static-libgcc" -sLINKFLAGS="-march=armv8-a -mtune=cortex-a53 -static-libstdc++ -static-libgcc -pthread" -sCC=$PWD/toolchains/gcc-linaro-5.5.0-2017.10-x86_64_aarch64_be-linux-gnu/bin/aarch64_be-linux-gnu-gcc -sCXX=$PWD/toolchains/gcc-linaro-5.5.0-2017.10-x86_64_aarch64_be-linux-gnu/bin/aarch64_be-linux-gnu-g++ -sLINK=$PWD/toolchains/gcc-linaro-5.5.0-2017.10-x86_64_aarch64_be-linux-gnu/bin/aarch64_be-linux-gnu-g++ -q clean
    - rm -r -f -v tests/run-test0* src/core/muleconfig.*
